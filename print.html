<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NixOS Release Wiki</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Home.html"><strong aria-hidden="true">1.</strong> Home</a></li><li class="chapter-item expanded "><a href="Roles.html"><strong aria-hidden="true">2.</strong> Roles</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Release-Managers.html"><strong aria-hidden="true">2.1.</strong> Release Managers</a></li><li class="chapter-item expanded "><a href="Release-Editors.html"><strong aria-hidden="true">2.2.</strong> Release Editors</a></li></ol></li><li class="chapter-item expanded "><a href="Release-Critical-Packages.html"><strong aria-hidden="true">3.</strong> Release Critical Packages</a></li><li class="chapter-item expanded "><a href="Release-Process.html"><strong aria-hidden="true">4.</strong> Release Process</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Once-Appointed.html"><strong aria-hidden="true">4.1.</strong> What to do once appointed</a></li><li class="chapter-item expanded "><a href="Feature-Freeze-Announcement.html"><strong aria-hidden="true">4.2.</strong> Feature Freeze announcement and pre-release cleanup</a></li><li class="chapter-item expanded "><a href="Zero-Hydra-Failures.html"><strong aria-hidden="true">4.3.</strong> ZERO Hydra Failures</a></li><li class="chapter-item expanded "><a href="Branch-Off.html"><strong aria-hidden="true">4.4.</strong> Branch-off</a></li><li class="chapter-item expanded "><a href="Beta-Phase.html"><strong aria-hidden="true">4.5.</strong> Beta Phase</a></li><li class="chapter-item expanded "><a href="Final-Release.html"><strong aria-hidden="true">4.6.</strong> Final Release</a></li><li class="chapter-item expanded "><a href="Retrospective.html"><strong aria-hidden="true">4.7.</strong> Retrospective</a></li><li class="chapter-item expanded "><a href="EOL-Cleanup.html"><strong aria-hidden="true">4.8.</strong> EOL cleanup</a></li><li class="chapter-item expanded "><a href="Handover.html"><strong aria-hidden="true">4.9.</strong> Handover to the next team</a></li></ol></li><li class="chapter-item expanded "><a href="Contrib.html"><strong aria-hidden="true">5.</strong> Contrib</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="QEMU-aarch64.html"><strong aria-hidden="true">5.1.</strong> QEMU Aarch64 Emulation</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NixOS Release Wiki</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p align="center">
  <a href="https://nixos.org/nixos"><img src="https://raw.githubusercontent.com/NixOS/nixos-artwork/master/logo/nixos-white.png" width="500px" alt="NixOS logo" /></a>
</p>
<p>This is the official wiki for the NixOS release process.
All release managers should document how they're actively changing the release process here.
And also use as it as a reference on how to release NixOS and engage the community.</p>
<p>This is not a set of rules but rather what the previous release managers did.
It mainly serves as a list of tasks to remember and is not written in stone.
This means that if you are a Release Manager and think you can do thing better, feel free to do so!
Also, if you are not a Release Manager and think the process can be improved, open an Issue or Pull Request on the <a href="https://github.com/NixOS/release-wiki">repository</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roles"><a class="header" href="#roles">Roles</a></h1>
<p>The release process currently knows two kinds of roles, whose duties
should be documented in this wiki.</p>
<ul>
<li><a href="Release-Managers.html">Release Managers</a></li>
<li><a href="Release-Editors.html">Release Editors</a></li>
</ul>
<p>Both roles have been filled by two persons each since the 22.11 release.</p>
<p>One person will have already worked on the previous release, while the
other one will be new to the release process, and can bring in new
ideas, while benefitting from the knowledge transfer.</p>
<p>The process to find new team member should be started at least two and
half months before the next release, so that the schedule documented in
this wiki can be followed. This &quot;Call for Release-Manager and Release
-Editor&quot; should be posted with sufficient spare time to the Discourse.</p>
<p>Examples:</p>
<ul>
<li><a href="https://discourse.nixos.org/t/22-11-call-for-release-manager-and-editor/21861">22.11 Call for Release Manager and Editor</a></li>
<li><a href="https://discourse.nixos.org/t/22-05-call-for-release-managers-and-editor/17663">22.05 Call for Release Managers and Editor</a></li>
<li><a href="https://discourse.nixos.org/t/21-11-call-for-release-manager/14934">21.11 Call for Release Manager</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-managers"><a class="header" href="#release-managers">Release Managers</a></h1>
<blockquote>
<p>When you are nixpkgs committer, you already have the skillset necessary for release management.
You just need to apply it in a different way.</p>
<p>— Jon Ringer</p>
</blockquote>
<p>For each release there are two release managers. After each release the
release manager having managed two releases steps down and the release
management team of the last release appoints a new release manager.</p>
<p>This makes sure a release management team always consists of one release
manager who already has managed one release and one release manager
being introduced to their role, making it easier to pass on knowledge
and experience.</p>
<p>Release managers for the current NixOS release are tracked by GitHub
team
<a href="https://github.com/orgs/NixOS/teams/nixos-release-managers/members"><code>@NixOS/nixos-release-managers</code></a>.</p>
<p>A release manager’s role and responsibilities are:</p>
<ul>
<li>
<p>manage the release process</p>
</li>
<li>
<p>start discussions about features and changes for a given release</p>
</li>
<li>
<p>create a roadmap</p>
</li>
<li>
<p>decide which bug fixes, features, etc… get backported after a
release</p>
</li>
</ul>
<p>This team has special write permissions to certain repositories in NixOS.
It is <strong>very</strong> important that the new co-release-manager removes the previous manager
from the team when they assign a new one.</p>
<p>A release manager must have the commit bit in the nixpkgs repository and must not
be part of an ongoing conflict, that would impact the execution of their duties
in this role.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-editors"><a class="header" href="#release-editors">Release Editors</a></h1>
<p>The role of the release editors is a result of an action item from the
21.11 release, where the satistfaction with the release notes was low.</p>
<p>The first release editor role was filled in the 22.05 release with a
focus on the release notes and content for the homepage.</p>
<h2 id="responsibiltiies"><a class="header" href="#responsibiltiies">Responsibiltiies</a></h2>
<ul>
<li>
<p>Improve the legibility of the release notes</p>
</li>
<li>
<p>Correct grammar and spelling issues</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-critical-packages"><a class="header" href="#release-critical-packages">Release Critical Packages</a></h1>
<p>These packages are deemed &quot;sufficiently complex&quot; in the package ecosystem to
warrant treating them differently when stabilizing the package set leading up to
a stable release. Generally, these packages will be closely related to <code>stdenv</code>
or fundamental to NixOS (e.g. <code>systemd</code>). The implications of 
<a href="https://github.com/NixOS/rfcs/blob/master/rfcs/0085-nixos-release-stablization.md">RFC 0085</a>
are that these packages can not have breaking changes applied to them for six weeks
leading up to a release date. This delay allows for changes in these packages to be
sufficiently stabilized through usage on unstable, and allows for many staging
iterations for these fixes to be applied.</p>
<h2 id="list-of-release-critical-packages"><a class="header" href="#list-of-release-critical-packages">List of Release Critical Packages:</a></h2>
<ul>
<li><code>binutils</code></li>
<li><code>gcc</code></li>
<li><code>glibc</code></li>
<li><code>llvm</code></li>
<li><code>systemd</code></li>
</ul>
<h3 id="process-for-modifying-release-critical-packages"><a class="header" href="#process-for-modifying-release-critical-packages">Process for Modifying Release Critical Packages</a></h3>
<p>A release retrospective will take place after a release occured; one of the
topics of discussion will be to modify the list of critical packages.
Packages may be added if they caused a significant amount of pain, or packages
may be removed if their updates cause little to no pain. Pain in this case
is defined as causing failing builds, regressions in downstream packages,
or regressions in user experience.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-process"><a class="header" href="#release-process">Release Process</a></h1>
<p>These pages give an overview of the release process with as many details as there are available at the time of writing.</p>
<h2 id="release-schedule"><a class="header" href="#release-schedule">Release Schedule</a></h2>
<p>With <a href="https://github.com/NixOS/rfcs/blob/master/rfcs/0085-nixos-release-stablization.md">RFC85</a>, the release schedule is largely already dictated below:</p>
<div class="table-wrapper"><table><thead><tr><th>Weeks from Release</th><th>Branches Affected</th><th>Events</th></tr></thead><tbody>
<tr><td>-8 Weeks</td><td></td><td>Start discussion about &quot;Feature Freeze &amp; Release Blockers&quot; with ecosystems maintainers</td></tr>
<tr><td>-6 Weeks</td><td><code>staging-next</code>, <code>staging</code></td><td>Restrict breaking changes to Release Critical Packages</td></tr>
<tr><td>-4 Weeks</td><td><code>staging-next</code>, <code>staging</code></td><td>Restrict all breaking changes with the exception of updates to desktop environment</td></tr>
<tr><td>-3 Weeks</td><td><code>master</code></td><td>Wait for <code>staging-next</code> merge into <code>master</code>, begin first <code>staging-next</code> cycle</td></tr>
<tr><td>-3 Weeks</td><td><code>master</code></td><td>Begin Zero Hydra Failures campaign</td></tr>
<tr><td>-2 Weeks</td><td><code>master</code></td><td>Wait for first <code>staging-next</code> merge into <code>master</code>; begin second <code>staging-next</code> cycle</td></tr>
<tr><td>-2 Weeks</td><td><code>staging</code></td><td>Unrestrict all breaking changes; new changes will not be present in the release</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code></td><td>Wait for second <code>staging-next</code> merge into <code>master</code></td></tr>
<tr><td>-1 Weeks</td><td><code>staging-next</code></td><td>Unrestrict all breaking changes; new changes will not be present in the release</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code>, <code>release</code></td><td>Perform Branch-off, create release channels, create new beta / unstable tags</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code></td><td>Mark failing packages as broken</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code>, <code>release</code></td><td>Create the release branch and tags</td></tr>
<tr><td>-1 Weeks</td><td><code>release</code></td><td>Create release channels</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code>, <code>release</code></td><td>Fixes need to use the &quot;backport&quot; workflow to arrive in the release</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code></td><td>Unrestrict all breaking changes; new changes will not be present in the release</td></tr>
<tr><td>-1 Weeks</td><td><code>release</code></td><td>Prepare for release, finish remaining issues</td></tr>
<tr><td>0 Weeks</td><td><code>release</code></td><td><strong>Release!</strong> Marks the end of the Zero Hydra Failures campaign.</td></tr>
<tr><td>+1 Weeks</td><td></td><td>Release Retrospective, everyone is invited to give feedback!</td></tr>
<tr><td>+4 Weeks</td><td></td><td>End of life cleanup</td></tr>
</tbody></table>
</div>
<p>Clarification of terms:</p>
<div class="table-wrapper"><table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody>
<tr><td><code>staging</code></td><td>Git branch used to batch changes which cause large rebuilds (<code>500+</code> packages). This is to avoid straining infrastructure trying to build large package sets with each change. Since nix captures all changes in a dependency tree, a change to a fundamental package like glibc can affect <code>50,000+</code> packages.</td></tr>
<tr><td><code>staging-next</code></td><td>Git branch used to build all of the batched changes. This branch has a <a href="https://hydra.nixos.org/jobset/nixpkgs/staging-next">Hydra jobset</a> which is used to fix regressions before the changes will be merged into master.</td></tr>
<tr><td><code>ZHF</code></td><td>Zero Hydra Failures. A 2-4 week window before a release where there is a large attempt to stabilize failing builds. Also allows for additional &quot;housekeeping&quot; such as removing stale, abandoned, or unmaintained packages.</td></tr>
</tbody></table>
</div>
<p>The purpose of these changes are mainly to push &quot;riskier&quot; PRs to being merged earlier,
or after a release. Merging pull-requests which may have many downstream breakages should
be avoided right before ZHF, as ZHF should focus on stabilization of the nixpkgs package
set, and not distracted by large noise-to-signal build failures. Also, fixes to packages
which required the <code>staging</code> process will likely require additional <code>staging</code> cycles to
remedy the regressions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-to-do-once-appointed"><a class="header" href="#what-to-do-once-appointed">What to do once appointed</a></h1>
<p>You have been appointed as the new Release Manager? Congratulations!
This is a loose list of things you could start doing now.
These tasks are not urgent but can be done as early as the appointment which should start to get you into your new role.
While not urgent, these task need to be completed at some point before the release process starts.
The release manager of the previous release will get in contact with you and help you along the way.</p>
<p>This is not an actual part of the release process but rather preparations for starting the process.</p>
<ul>
<li>Get in contact with the previous release manager and schedule a meeting</li>
<li>Join the <a href="https://matrix.to/#/#nixos-release-management:nixos.org">release management room</a> on Matrix
<ul>
<li>Request moderator permissions on the room, this allows to manage the topic and create video calls</li>
</ul>
</li>
<li>Gain access to the <a href="https://github.com/orgs/NixOS/teams/nixos-release-managers/members">release-manager GitHub Team</a> by asking any of the existing people with &quot;Manager&quot; rights
<ul>
<li>Also make sure there are only people left as members who are managing this release</li>
</ul>
</li>
<li>Gain access to the <a href="https://discourse.nixos.org/g/nixos-release">nixos-release Discourse Team</a>
<ul>
<li>Your partner should have the permissions to invite you. Make sure to remove previous members, who are not active anymore.</li>
</ul>
</li>
<li>Update the <a href="https://github.com/NixOS/nixos-homepage/blob/main/src/content/teams/05_nixos-release.mdx">NixOS Release Team</a> members on the homepage
<ul>
<li>You will be the primary contact for this release, your experienced team mate will be secondary.</li>
</ul>
</li>
<li>Ensure you have a <a href="https://hydra.nixos.org/">Hydra</a> account which will come in handy
<ul>
<li>Ensure that all release managers have at least <code>restart-jobs</code>, <code>bump-to-front</code>, and <code>cancel-build</code> privileges (see the top-right &quot;Preferences&quot; button). If they are missing, reach out to the Infrastructure team</li>
</ul>
</li>
<li>Create a blockers <a href="https://github.com/orgs/NixOS/projects">project</a> in the organization for your release and the next one
<ul>
<li>Also close old ones while you're at it and consider migrating remaining open issues to the current project</li>
</ul>
</li>
<li>Figure out a codename for the next release (not the one you are releasing but the next one) and write it down somewhere for the branch-off</li>
<li>Find someone to create a <a href="https://github.com/NixOS/nixos-artwork/tree/master/releases">logo</a> or create one yourself for the current release and PR it into the repository
<ul>
<li>Usually done by creating an issue on the <code>nixos-artwork</code> repository pinging artists who created previous logos</li>
</ul>
</li>
<li>Check if the process can be improved this release
<ul>
<li>Find comments on the Discourse posts, GitHub issues, … of the previous release and see if the comments suggest doing something different this time</li>
<li>Read the Discourse post of the last retrospective</li>
<li>Check the Issues and Pull Requests of the <a href="https://github.com/NixOS/release-wiki">release-wiki repository</a></li>
</ul>
</li>
<li>Figure out concrete dates for the week offsets outlined in schedule</li>
<li>Publish a &quot;Let's have a great XX.XX release cycle!&quot; post on Discourse, outlining the plans for this release. Examples: <a href="https://discourse.nixos.org/t/lets-have-a-great-22-05-release-cycle/18357">22.05</a>
<ul>
<li>This links to the release schedule issue (examples: <a href="https://github.com/NixOS/nixpkgs/issues/193585">22.11</a>, <a href="https://github.com/NixOS/nixpkgs/issues/165792">22.05</a>) which must be created before posting to Discourse</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="feature-freeze-announcement-and-pre-release-cleanup"><a class="header" href="#feature-freeze-announcement-and-pre-release-cleanup">Feature Freeze announcement and pre-release cleanup</a></h1>
<p>The feature freeze announcement should be done 8 weeks before the release to
inform subsystem maintainers about the upcoming feature freeze and to discuss
potential blockers in the respective subsystems. This announcement is done on
GitHub (<a href="https://github.com/NixOS/nixpkgs/issues/167025">22.05
example</a>). It's also a good
idea to cross-post this to Discourse to raise awareness about the upcoming
freeze (<a href="https://discourse.nixos.org/t/22-05-feature-freeze/18453">22.05
example</a>).</p>
<p>People and teams will be pinged in this issue. The list of people and teams
pinged is generated from the teams list in nixpkgs. The script to generate
the pings is: <code>./maintainers/feature-freeze-teams.pl</code> in nixpkgs. The script
needs a GitHub username and a token to read the teams from the NixOS org.
Instructions are provided as a comment in the script.</p>
<p>You might need to add a comment that pings people again because GitHub seems
to limit the amount of people that can be pinged per post.</p>
<h2 id="pre-release-cleanup"><a class="header" href="#pre-release-cleanup">Pre-release cleanup</a></h2>
<p>The pre-release cleanup consists of multiple small cleanups to keep the release
secure throughout its lifecycle while also maintaining some level of
cleanliness.</p>
<ul>
<li>
<p>Remove attributes that we know we will not be able to support,
especially if there is a stable alternative. E.g. Check that our
Linux kernels’ <a href="https://www.kernel.org/category/releases.html">projected
end-of-life</a> are
after our release projected end-of-life.</p>
<p>Many EOL dates are also tracked by the <a href="https://endoflife.date">endoflife.date</a>
project and some packages might need closer supervision in that regard.</p>
<p>The <a href="https://github.com/NixOS/nixpkgs/projects/18">&quot;Picking up the garbage&quot;</a>
project tracks problematic packages that should be removed.</p>
</li>
<li>
<p>Attributes that can also be safely removed are packages that were broken for
more than 2 years.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="zero-hydra-failures"><a class="header" href="#zero-hydra-failures">ZERO Hydra Failures</a></h1>
<h2 id="hydra-scaling"><a class="header" href="#hydra-scaling">Hydra scaling</a></h2>
<p>The activity during ZHF is usually higher, so more build capacity is a good
investment, to keep up with the pace of contributions.</p>
<p>There is an autoscaler in place for aarch64-linux and x86_64-linux while the
darwin allocations are pretty much static.</p>
<p>If capacity issues are apparent, contact the infrastructure team on the
<code>infra</code> repository (example: <a href="https://github.com/NixOS/infra/issues/186">21.11 example</a>),
and start a discussion in <a href="https://matrix.to/#/#infra:nixos.org">#infra:nixos.org</a>.</p>
<h2 id="zhf-issue"><a class="header" href="#zhf-issue">ZHF issue</a></h2>
<ul>
<li>
<p>Create an issue for tracking Zero Hydra Failures progress. ZHF is an effort
to get build failures down to zero. Examples:
<a href="https://github.com/NixOS/nixpkgs/issues/199919">22.11</a>, <a href="https://github.com/NixOS/nixpkgs/issues/172160">22.05</a></p>
</li>
<li>
<p>The <a href="https://hydra.nixos.org/jobset/nixpkgs/trunk">nixpkgs/trunk</a> jobset is ideal
to track regressions, since it builds for all platforms.</p>
</li>
<li>
<p>Subscribe to the issue and monitor the conversation for new blockers.</p>
</li>
<li>
<p>Get in contact with the staging team through their Matrix room at <a href="https://matrix.to/#/#staging:nixos.org">#staging:nixos.org</a>
to coordinate the staging-next merges.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="branch-off"><a class="header" href="#branch-off">Branch-off</a></h1>
<p>For these steps &quot;24.05&quot; represents the current release tag and &quot;24.11&quot; represents the next
(6 months in the future) release tag. &quot;23.11&quot; is the last release which was released 6 months
ago.</p>
<h2 id="jobset-creation"><a class="header" href="#jobset-creation">Jobset creation</a></h2>
<p>The <a href="https://matrix.to/#/#infra:nixos.org">infrastructure team</a> can create the necessary jobsets
in advance. They will not evaluate because the release branch doesn't exist but it allows the
infrastructure team and the release team to work more asynchronously. Reach out to them 1-2 days
before release to create the necessary Hydra Jobsets. You can link them this section.</p>
<ul>
<li><a href="https://hydra.nixos.org/project/nixos">https://hydra.nixos.org/project/nixos</a>
<ul>
<li>release-24.05</li>
<li>release-24.05-small</li>
</ul>
</li>
<li><a href="https://hydra.nixos.org/project/nixpkgs">https://hydra.nixos.org/project/nixpkgs</a>
<ul>
<li>nixpkgs-24.05-darwin</li>
<li>staging-next-24.05</li>
</ul>
</li>
</ul>
<p>Example configuration: <a href="https://hydra.nixos.org/jobset/nixos/release-23.11#tabs-configuration">nixos:release-23.11</a></p>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>
<tr><td>State</td><td>Enabled</td></tr>
<tr><td>Description</td><td>NixOS 24.05 release branch</td></tr>
<tr><td>Nix expression</td><td><code>nixos/release-combined.nix</code> in input <code>nixpkgs</code></td></tr>
<tr><td>Check interval</td><td>86400</td></tr>
<tr><td>Scheduling shares</td><td>5000000 (8.32% out of 60071636 shares)</td></tr>
<tr><td>Enable Dynamic RunCommand Hooks:</td><td>No (not enabled by server)</td></tr>
<tr><td>Number of evaluations to keep</td><td>1</td></tr>
</tbody></table>
</div>
<p>Inputs:</p>
<div class="table-wrapper"><table><thead><tr><th>Input name</th><th>Type</th><th>Values</th></tr></thead><tbody>
<tr><td><code>nixpkgs</code></td><td>Git checkout</td><td><code>https://github.com/NixOS/nixpkgs.git release-24.05</code></td></tr>
<tr><td><code>stableBranch</code></td><td>Boolean</td><td><code>false</code></td></tr>
<tr><td><code>supportedSystems</code></td><td>Nix expression</td><td><code>[ &quot;x86_64-linux&quot; &quot;aarch64-linux&quot; ]</code></td></tr>
</tbody></table>
</div>
<h2 id="actual-branch-off"><a class="header" href="#actual-branch-off">Actual branch-off</a></h2>
<p>Set NEWVER to the new release version:</p>
<pre><code class="language-bash">export NEWVER=24.05
</code></pre>
<h3 id="on-the-master-branch"><a class="header" href="#on-the-master-branch">On the master branch</a></h3>
<p>Pull in the final changes before performing the actal branch-off.</p>
<ol>
<li>
<p>Wait for the staging team to merge the final staging-next iteration</p>
</li>
<li>
<p>Fetch and check out the master branch</p>
</li>
<li>
<p>Create the release branch:</p>
<pre><code class="language-bash">git switch -c release-$NEWVER
</code></pre>
</li>
</ol>
<h3 id="on-the-release-branch"><a class="header" href="#on-the-release-branch">On the release branch</a></h3>
<p>Update metadata on the release branch, create its staging branches and tag the release.</p>
<ol>
<li>
<p>Update the <code>system.defaultChannel</code> attribute in <a href="https://github.com/NixOS/nixpkgs/commit/bb029673bface2fc9fb807f209f63ca06478a72d"><code>nixos/modules/config/nix-channel.nix</code></a></p>
</li>
<li>
<p>Update the <code>versionSuffix</code> attribute in <a href="https://github.com/NixOS/nixpkgs/commit/7ae60dd7068478db5d936a3850b6df859aec21d0"><code>nixos/release.nix</code></a></p>
<p>To get the commit count, use the following command:</p>
<pre><code class="language-bash">git rev-list --count release-$NEWVER
</code></pre>
</li>
<li>
<p>Add <code>SUPPORT_END=YYYY-MM-DD</code> to <code>osReleaseContents</code> in <code>nixos/modules/misc/version.nix</code>.</p>
</li>
<li>
<p>Commit the changes from the previous steps</p>
<pre><code class="language-bash">git commit -m &quot;$NEWVER beta release&quot; -S
</code></pre>
</li>
<li>
<p>Create the staging branches</p>
<pre><code class="language-bash">git branch staging-$NEWVER
git branch staging-next-$NEWVER
</code></pre>
</li>
<li>
<p>Tag the release and push everything</p>
<pre><code class="language-bash">git tag --annotate --message=&quot;Release $NEWVER-beta&quot; $NEWVER-beta
git push upstream master release-$NEWVER $NEWVER-beta staging-$NEWVER staging-next-$NEWVER
</code></pre>
</li>
<li>
<p>Create jobsets on hydra by contacting the infrastructure team and start the evaluation on all new jobsets.</p>
</li>
<li>
<p>Switch back to the master branch</p>
<pre><code class="language-bash">git switch master
</code></pre>
</li>
</ol>
<h3 id="back-on-the-master-branch"><a class="header" href="#back-on-the-master-branch">Back on the master branch</a></h3>
<p>Now we prepare the master branch for the next release after this one.</p>
<ol>
<li>
<p>Update the <a href="https://github.com/NixOS/nixpkgs/blob/master/.github/workflows/periodic-merge-24h.yml">periodic-merge workflow</a> to include the new release.</p>
</li>
<li>
<p>Increment the <a href="https://github.com/NixOS/nixpkgs/commit/01268fda85b7eee4e462c873d8654f975067731f#diff-2bc0e46110b507d6d5a344264ef15adaR1"><code>.version</code></a>
file in the repository root.</p>
<pre><code class="language-bash"># The release after $NEWVER (24.05 -&gt; 24.11)
echo -n &quot;24.11&quot; &gt; .version
</code></pre>
</li>
<li>
<p>Update the <code>codeName</code> attribute in <a href="https://github.com/NixOS/nixpkgs/commit/2c28f1de7cdc10be556d2106108411dd2482794b#diff-29c71aa8261b14b1cad6e6fa28486fed7295050db4eeb32ba205672ba91d40e1"><code>lib/trivial.nix</code></a>
This will be the name for the next release.</p>
</li>
<li>
<p>Create a new <a href="https://github.com/NixOS/nixpkgs/blob/44b98d80ea6a56ccc1838aa0ac9e891de9130913/nixos/doc/manual/release-notes/rl-2311.section.md?plain=1">release notes file</a>
for the next release</p>
</li>
<li>
<p>Update the release versions in <a href="https://github.com/NixOS/nixpkgs/commit/2c6ae7132ca558f1052da0eececed3cad191b883#diff-18813c86948efc57e661623d7ba48ff94325c9b5421ec9177f724922dd553a35"><code>.github/PULL_REQUEST_TEMPLATE.md</code></a>
on master.</p>
</li>
<li>
<p>Update <a href="https://github.com/NixOS/nixpkgs/commit/2c6ae7132ca558f1052da0eececed3cad191b883#diff-eca12c0a30e25b4b46522ebf89465a03ba72a03f540796c979137931d8f92055"><code>CONTRIBUTING.md</code></a> on master.</p>
</li>
<li>
<p>Commit the changes (<a href="https://github.com/NixOS/nixpkgs/commit/2c28f1de7cdc10be556d2106108411dd2482794b">23.05 example</a> + <a href="https://github.com/NixOS/nixpkgs/commit/44b98d80ea6a56ccc1838aa0ac9e891de9130913">this commit</a> + <a href="https://github.com/NixOS/nixpkgs/commit/2c6ae7132ca558f1052da0eececed3cad191b883">this commit</a>)</p>
</li>
<li>
<p>Tag the master branch, so that <code>git describe</code> shows the new version as the base for commits.</p>
<pre><code class="language-bash">git tag --annotate 24.11-pre
git push upstream master 24.11-pre
git describe HEAD # should yield 24.11-pre
</code></pre>
</li>
</ol>
<h3 id="and-afterwards"><a class="header" href="#and-afterwards">And afterwards</a></h3>
<p>Now that everything on git is done, we are still missing the channels.</p>
<ol>
<li>
<p>Create the necessary channels for <code>https://channels.nixos.org</code> in beta status, by updating
<a href="https://github.com/NixOS/infra/blob/master/channels.nix"><code>channels.nix</code></a> in <code>infra</code>
and nag the infrastructure team to get these changes deployed.</p>
<p>Example: <a href="https://github.com/NixOS/infra/commit/9a0b3674a11b445c973334c78e8ca0eda36775e4">22.11</a></p>
</li>
<li>
<p>Create the backport <a href="https://github.com/NixOS/nixpkgs/labels">labels</a> for all new branches:</p>
<ul>
<li><code>backport staging-24.05</code></li>
<li><code>backport release-24.05</code></li>
</ul>
<p>Use the description <code>Backport PR automatically</code> and the color value <code>#0fafaa</code></p>
</li>
<li>
<p>Update the ZHF issue, that now that the branch-off has been performed, fixes have to be backported.
Examples: <a href="https://github.com/NixOS/nixpkgs/issues/172160#issuecomment-1135112918">22.05</a></p>
</li>
</ol>
<h3 id="once-the-channel-is-available"><a class="header" href="#once-the-channel-is-available">Once the channel is available</a></h3>
<p>The following steps should be done after the channels have become available on <a href="https://channels.nixos.org">channels.nixos.org</a>.</p>
<ol>
<li>
<p>Update the flake input on the <code>nixos-search</code> repository, and create a pull request:</p>
<pre><code class="language-bash">git clone git@github.com:nixos/nixos-search
nix --extra-experimental-features &quot;nix-command flakes&quot; flake lock --update-input nixos-infra
</code></pre>
</li>
<li>
<p>Give the <a href="https://matrix.to/#/#marketing:nixos.org">Marketing team</a> a heads-up about the upcoming release</p>
</li>
<li>
<p>Get in contact with <a href="https://github.com/arianvp">Arian van Putten</a></p>
<ol>
<li>They will need to update <a href="https://github.com/NixOS/amis/blob/main/.github/workflows/upload-legacy-ami.yml">upload-legacy-ami.yml</a> to point to the new jobset. This will automatically upload the AMIs from the jobset to AWS</li>
<li>A PR is also welcome :)</li>
</ol>
</li>
<li>
<p>Make sure the release editors have started finalizing the release notes. Only 7 days left until release!</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="beta-phase"><a class="header" href="#beta-phase">Beta Phase</a></h1>
<ul>
<li>
<p>Monitor the master branch for bugfixes and minor updates and
cherry-pick them to the release branch.</p>
</li>
<li>
<p>Start marking packages as broken. There is no fully defined process to do
this, so look at the corresponding
<a href="https://github.com/NixOS/release-wiki/issues/4">issue</a> and also
<a href="https://github.com/NixOS/release-wiki/pull/42#discussion_r882695363">this discussion</a>.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="final-release"><a class="header" href="#final-release">Final Release</a></h1>
<p>Set the following environment variables to execute the commands below</p>
<pre><code class="language-bash"># The version of the previous stable release
export OLDVER=22.11
# The version that is about to be released
export NEWVER=23.05
</code></pre>
<h2 id="before-the-final-release"><a class="header" href="#before-the-final-release">Before the final release</a></h2>
<ul>
<li>
<p>Two days before expected release date, change <code>stableBranch</code> to <code>true</code> in Hydra and wait for the channel to update</p>
</li>
<li>
<p>Re-check that the release editors have completed their work on the release notes</p>
</li>
<li>
<p>Merge the Pull Request that marks broken packages as broken</p>
</li>
<li>
<p>Update <a href="https://github.com/NixOS/nixpkgs/commit/40fd9ae3ac8048758abdcfc7d28a78b5f22fe97e">README.md</a> on master with
new stable NixOS version information. Then backport the change to the release branch.</p>
</li>
<li>
<p>Update <a href="https://nixos.org/manual/nixos/stable/index.html#sec-upgrading">Upgrading NixOS</a> section of the manual to
match new stable release version and backport this as well. This way the manual will already reflect the new version
on release. Example: <a href="https://github.com/nixos/nixpkgs/commit/cbaacfb8dfa2ddadfb152fa8ef163b40db9041af">22.05</a></p>
</li>
<li>
<p>Ensure the installer images are sufficiently tested on both aarch64 and x86_64 linux:</p>
<ul>
<li>Graphical (GNOME/KDE)</li>
<li>Minimal</li>
</ul>
<p>All ISO images can be found on the <code>nixos/release-$NEWVER</code> hydra jobset.</p>
<p>If you don't have any hardware to test the aarch64-linux on, <a href="QEMU-aarch64.html">QEMU
emulation</a> should allow to boot the images in a
reasonable time to check the installer starts and is usable.</p>
</li>
<li>
<p>Gather some information about the release for the final announcement</p>
<ul>
<li>
<p>Number of non-merge commits for the release:</p>
<pre><code class="language-bash">git log upstream/release-$OLDVER..upstream/release-$NEWVER --no-merges --format=%an | wc -l
</code></pre>
</li>
<li>
<p>Number of contributors for this release:</p>
<pre><code class="language-bash">git log upstream/release-$OLDVER..upstream/release-$NEWVER --no-merges --format=%an | sort | uniq | wc -l
</code></pre>
</li>
<li>
<p>New/updated/removed packages:</p>
<pre><code class="language-bash">git switch release-$OLDVER
NIX_PATH= nix-env -f $PWD -qaP --json --out-path &gt; old.json

git switch release-$NEWVER
NIX_PATH= nix-env -f $PWD -qaP --json --out-path &gt; new.json
</code></pre>
<pre><code class="language-python">#!/usr/bin/env python3

import json

with open('old.json') as f:
    old = json.load(f)
with open('new.json') as f:
    new = json.load(f)

n_removed = 0
n_new = 0
n_updated = 0
for pkgname,pkg in new.items():
    if pkgname not in old:
        n_new += 1
        continue
    if pkg[&quot;version&quot;] != old[pkgname][&quot;version&quot;]:
        n_updated += 1
for pkgname in old.keys():
    if pkgname not in new:
        n_removed += 1

print(f&quot;New: {n_new}&quot;)
print(f&quot;Rem: {n_removed}&quot;)
print(f&quot;Upd: {n_updated}&quot;)
</code></pre>
<p>Best to check how the previous announcement post was formulated to see what needs to
be included.</p>
</li>
<li>
<p>Added/removed modules:</p>
<pre><code class="language-bash">git diff release-$OLDVER..release-$NEWVER nixos/modules/module-list.nix | grep ^+ | wc -l
git diff release-$OLDVER..release-$NEWVER nixos/modules/module-list.nix | grep ^- | wc -l
</code></pre>
</li>
<li>
<p>Added/removed options:</p>
<p>Download the result of the <code>nixos.options</code> job in Hydra from both your release and the previous release, then do:</p>
<pre><code class="language-bash"># removed options:
comm -23 &lt;(jq -r 'keys[]' old.json | sort) &lt;(jq -r 'keys[]' new.json | sort) | wc -l
# new options:
comm -13 &lt;(jq -r 'keys[]' old.json | sort) &lt;(jq -r 'keys[]' new.json | sort) | wc -l
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="at-final-release-time"><a class="header" href="#at-final-release-time">At final release time</a></h2>
<h3 id="on-the-master-branch-1"><a class="header" href="#on-the-master-branch-1">On the master branch</a></h3>
<ol>
<li>
<p>Create these PRs on master and backport to the release branch:</p>
<ol>
<li>
<p>Update <code>rl-$NEWVER.section.md</code> with the final release date.</p>
</li>
<li>
<p>Commit and push all changes.</p>
<pre><code class="language-bash">git commit -m &quot;Release NixOS $NEWVER&quot; -S
git push upstream master
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="on-the-release-branch-1"><a class="header" href="#on-the-release-branch-1">On the release branch</a></h3>
<ol>
<li>
<p>Switch to the release branch</p>
<pre><code class="language-bash">git switch release-$NEWVER
</code></pre>
</li>
<li>
<p>Cherry-pick the release commit from master</p>
</li>
<li>
<p>Push the commit to the release branch</p>
<pre><code class="language-bash">git push
</code></pre>
</li>
<li>
<p>Find the commit id and tag the release <strong>on the release branch</strong>:</p>
<pre><code class="language-bash">git tag --annotate --message=&quot;Release $NEWVER&quot; $NEWVER &lt;COMMIT_ID&gt;
git push upstream $NEWVER
</code></pre>
</li>
<li>
<p>Update <a href="https://github.com/NixOS/nixos-homepage">nixos-homepage</a> for the release.</p>
<p>Examples: <a href="https://github.com/NixOS/nixos-homepage/pull/952">22.11</a>, <a href="https://github.com/NixOS/nixos-homepage/pull/853">22.05</a></p>
<p>This step requires the released ISOs, from the hydra evaluation with <code>stableBranch</code> enabled, to be available.</p>
<ol>
<li>
<p>Update the <a href="https://github.com/NixOS/nixos-homepage/blob/bd11c42e925f192e6e2d369d021b58046daf384c/flake.nix#L9"><code>flake.nix</code></a>
input <code>released-nixpkgs</code> to $NEWVER and then run:</p>
</li>
<li>
<p>Run <code>./scripts/update.sh</code> (this updates flake.lock to updated channel).</p>
</li>
<li>
<p>Add a compressed version of the NixOS logo (<a href="https://github.com/NixOS/nixos-homepage/blob/a5626c71c03a2dd69086564e56f1a230a2bb177a/logo/nixos-logo-19.09-loris-lores.png">19.09 example</a>). The logo should have a width of 100px.</p>
</li>
<li>
<p>Write the announcement to <code>blog/announcements.xml</code></p>
</li>
<li>
<p>Create a pull request and poke the marking team. Make sure to
push to a branch on the <code>nixos-homepage</code> repository, not your
own fork, so the CI actions work properly.</p>
</li>
</ol>
<p>The website is hosted by a CDN so you may occasionally see the old site for a couple of minutes/hours (?) after your changes</p>
</li>
<li>
<p>Update <a href="https://github.com/NixOS/infra">infra</a> to reflect the <code>stable</code> channel
status for $NEWVER and the <code>deprecated</code> status for $OLDVER.</p>
<p>Examples: <a href="https://github.com/NixOS/infra/pull/228">22.11</a>, <a href="https://github.com/NixOS/infra/pull/210">22.05</a>, <a href="https://github.com/NixOS/infra/pull/192">21.11</a></p>
</li>
<li>
<p>Create a new topic on <a href="https://discourse.nixos.org/">Discourse</a> to announce the release.</p>
<p>Examples: <a href="https://discourse.nixos.org/t/nixos-22-11-released/23637">22.11</a>, <a href="https://discourse.nixos.org/t/nixos-22-05-released/19404">22.05</a></p>
</li>
<li>
<p>Once the Pull Request in <code>infra</code> is merged, update <a href="https://github.com/NixOS/nixos-search/">nixos-search</a> to mark the channel as released.
This is the same process as for the creation of the beta channel in the project.</p>
</li>
</ol>
<h2 id="after-release"><a class="header" href="#after-release">After Release</a></h2>
<ol>
<li>
<p>Add the new release to repology. Don't remove old releases, they want to keep them around.</p>
<p>Examples: <a href="https://github.com/repology/repology-updater/pull/1289">22.11</a>, <a href="https://github.com/repology/repology-updater/pull/1156">22.05</a></p>
</li>
<li>
<p>Update osinfo-db entries.</p>
<p>Examples: <a href="https://gitlab.com/libosinfo/osinfo-db/-/merge_requests/539">22.11</a>, <a href="https://gitlab.com/libosinfo/osinfo-db/-/merge_requests/457">22.05</a>, <a href="https://gitlab.com/libosinfo/osinfo-db/-/merge_requests/385">21.11</a></p>
<pre><code class="language-bash">nix-shell -p &quot;python3.withPackages (p: [ p.lxml p.requests ])&quot; -p cdrkit
./scripts/updates/nixos.py --release YY.MM --codename &lt;codename&gt; --release-date YYYY-MM-DD --next-release YY.MM
git add .
git commit -s -m &quot;nixos: Add YY.MM release&quot;

# run tests to validate your changes
nix-shell -p &quot;python3.withPackages (p: [ p.lxml p.requests p.pytest ])&quot; -p cdrkit osinfo-db-tools gettext --run &quot;make check&quot;
</code></pre>
</li>
<li>
<p>Check that the AMI image references have been updated in <code>nixos/modules/virtualisation/amazon-ec2-amis.nix</code>.</p>
</li>
<li>
<p>Close the <a href="https://github.com/NixOS/nixpkgs/milestones">milestone</a></p>
</li>
<li>
<p>Close the <a href="https://github.com/orgs/NixOS/projects">blockers project</a></p>
</li>
<li>
<p>Close all issues you opened for the release and unpin them if necessary</p>
</li>
<li>
<p>Ask someone with the appropriate permissions to update the description of the NixOS and NixOS Dev Matrix rooms to include the new release</p>
</li>
<li>
<p>Create an announcement for the retrospective, some days after the old channel is discontinued.</p>
<p>Examples: <a href="https://discourse.nixos.org/t/nixos-22-11-retrospective/23858">22.11</a>, <a href="https://discourse.nixos.org/t/22-05-retrospective/19413">22.05</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retrospective"><a class="header" href="#retrospective">Retrospective</a></h1>
<p>The retrospective is an important part of the release process where we
give every member of the community the chance to give feedback about
their experience, what went well and what did not.</p>
<h2 id="after-the-release"><a class="header" href="#after-the-release">After the release</a></h2>
<ol>
<li>
<p>Set a date and time one week after the release date. This is still
early enough, so people will remember things about the release, but
late enough, so they will have had time to reflect. An hour is
usually sufficient for this.</p>
<p>Make sure the time slot works for people from the EU and US, where
most of the current contributors reside.</p>
</li>
<li>
<p>Plan a venue. We usually rely on Jitsi Meet for conversations that
include audio/video as well as screensharing.</p>
</li>
<li>
<p>Create the invitation post over on the Discourse. Examples:</p>
<ul>
<li><a href="https://discourse.nixos.org/t/nixos-22-11-retrospective/23858/5">NixOS 22.11 Retrospective</a></li>
<li><a href="https://discourse.nixos.org/t/22-05-retrospective/19413">22.05 Retrospective</a></li>
<li><a href="https://discourse.nixos.org/t/21-11-retrospective/16406">21.11 Retrospective</a></li>
</ul>
</li>
</ol>
<h2 id="during-the-retrospective"><a class="header" href="#during-the-retrospective">During the retrospective</a></h2>
<ol>
<li>
<p>Provide a collaborative document, that participants can edit. It
should allow adding and classifying discussion items. In recent
retrospectives we classified things as good/neutral/bad.</p>
<p>Examples:</p>
<ul>
<li><a href="https://docs.google.com/spreadsheets/d/1Ohn1s9RFFMAfd_XMF8sJNl7xs9QpAtYNTjEY9IwXAho/edit#gid=0">22.11 Retrospective</a></li>
</ul>
</li>
<li>
<p>Put up limits for how long a single discussion point can take place,
so every topic can be addressed.</p>
</li>
<li>
<p>Identify action items from the discussion points and identify
people who would want to follow up on those.</p>
</li>
</ol>
<h2 id="after-the-retrospective"><a class="header" href="#after-the-retrospective">After the retrospective</a></h2>
<ol>
<li>
<p>Post the conclusions onto the Discourse thread. Also link the notes
that were made during the event.</p>
</li>
<li>
<p>Follow up on assigned action items.</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eol-cleanup"><a class="header" href="#eol-cleanup">EOL cleanup</a></h1>
<p>The old release reaches its end of life one month after the new release
gets released. At that point a few cleanup tasks need to be done.</p>
<ol>
<li>
<p>Set the EOL channel status from <code>deprecated</code> to <code>unmaintained</code> in <code>infra</code>. Examples:</p>
<ul>
<li><a href="https://github.com/NixOS/infra/pull/229">channels: Deprecate NixOS 22.05</a></li>
<li><a href="https://github.com/NixOS/infra/pull/211">channels: Mark 21.11 as unmaintained</a></li>
<li><a href="https://github.com/NixOS/infra/pull/201">channels:21.05 is unmaintained</a></li>
</ul>
</li>
<li>
<p>Once this is merged, update the <a href="https://github.com/NixOS/nixos-search"><code>nixos-search</code></a>
repository to reflect that status on <a href="https://search.nixos.org">search.nixos.org</a>.</p>
<pre><code class="language-bash">nix --extra-experimental-features &quot;nix-command flakes&quot; flake lock --update-input nixos-infra
</code></pre>
</li>
<li>
<p>Close all pull requests that target one of the the old release- or staging-branches</p>
</li>
<li>
<p>Prune old <a href="https://github.com/NixOS/nixpkgs/labels?q=backport">backport labels</a></p>
</li>
<li>
<p>Remove the old release from the <a href="https://github.com/NixOS/nixpkgs/commit/8befefd1a72da597bdb1d01e97127e0c9866912e">periodic merge workflows</a></p>
</li>
<li>
<p>Increase the <code>oldestSupportedRelease</code> in <code>lib/trivial.nix</code> to match
the oldest supported release.</p>
<p>Examples: <a href="https://github.com/NixOS/nixpkgs/pull/180152">22.05</a></p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="handover-to-the-next-team"><a class="header" href="#handover-to-the-next-team">Handover to the next team</a></h1>
<p>Some time after your EOL cleanup, publish a new topic to Discourse, asking for a new editor and a new manager to step up.
You select the team.</p>
<p>It's often a good idea to schedule a meeting with the upcoming team to get to know each other.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contrib"><a class="header" href="#contrib">Contrib</a></h1>
<p>This section holds scripts that can be helpful in the context of the
release, but are optional and would likely impact the legibility of
the documentation if included inline.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu-aarch64-emulation"><a class="header" href="#qemu-aarch64-emulation">QEMU aarch64 emulation</a></h1>
<p>The following script should allow booting the aarch64-linux UEFI
installer ISOs provided through the <code>nixos:unstable-small</code> and
<code>nixos:trunk</code> jobsets, when no native hardware support exists.</p>
<p>Pass the ISO file as the first argument, and everything should boot up.</p>
<pre><code class="language-bash">#!/usr/bin/env nix-shell
#!nix-shell -i bash -p qemu_full virt-viewer
# shellcheck shell=bash

set -euo pipefail

BASEDIR=$(dirname &quot;$0&quot;)

VMNAME=nixos-aarch64
ISO=&quot;${BASEDIR}/$1&quot;
NVRAM=&quot;${BASEDIR}/vars-pflash.raw&quot;
CORES=6
MEMORY=4096
KEYBOARD=&quot;de&quot;

cleanup() {
	kill &quot;$QEMU_PID&quot; || true
}

trap cleanup EXIT

run_vm() {
	OVMF_FD=$(nix-build '&lt;nixpkgs&gt;' --no-out-link -A OVMF.fd --system aarch64-linux)
	test -f &quot;${NVRAM}&quot; || {
		cp &quot;${OVMF_FD}/AAVMF/vars-template-pflash.raw&quot; &quot;${NVRAM}&quot;
		chmod u+w &quot;${NVRAM}&quot;
	}

	qemu-system-aarch64 \
		-name $VMNAME,process=$VMNAME \
		-machine virt,gic-version=max \
		--accel tcg,thread=multi \
		-cpu max \
		-smp $CORES \
		-m $MEMORY \
		-k $KEYBOARD \
		-serial stdio \
		-drive if=pflash,format=raw,file=&quot;${OVMF_FD}/AAVMF//QEMU_EFI-pflash.raw&quot;,readonly=on \
		-drive if=pflash,format=raw,file=&quot;${NVRAM}&quot; \
		-device virtio-scsi-pci \
		-device virtio-gpu-pci \
		-device virtio-net-pci,netdev=wan \
		-netdev user,id=wan \
		-device virtio-rng-pci,rng=rng0 \
		-object rng-random,filename=/dev/urandom,id=rng0 \
		-device virtio-serial-pci \
		-drive file=&quot;${ISO}&quot;,media=cdrom \
		-boot d

	QEMU_PID=$!
}

run_vm
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>

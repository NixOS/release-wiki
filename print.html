<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NixOS Release Wiki</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Home.html"><strong aria-hidden="true">1.</strong> Home</a></li><li class="chapter-item expanded "><a href="Release-Management-Team.html"><strong aria-hidden="true">2.</strong> Release Management Team</a></li><li class="chapter-item expanded "><a href="Release-Critical-Packages.html"><strong aria-hidden="true">3.</strong> Release Critical Packages</a></li><li class="chapter-item expanded "><a href="Release-Process.html"><strong aria-hidden="true">4.</strong> Release Process</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Once-Appointed.html"><strong aria-hidden="true">4.1.</strong> What to do once appointed</a></li><li class="chapter-item expanded "><a href="Feature-Freeze-Announcement.html"><strong aria-hidden="true">4.2.</strong> Feature Freeze announcement and pre-release cleanup</a></li><li class="chapter-item expanded "><a href="Zero-Hydra-Failures.html"><strong aria-hidden="true">4.3.</strong> ZERO Hydra Failures</a></li><li class="chapter-item expanded "><a href="Branch-Off.html"><strong aria-hidden="true">4.4.</strong> Branch-off</a></li><li class="chapter-item expanded "><a href="Release-Process-Walkthrough.html"><strong aria-hidden="true">4.5.</strong> Release Process Walkthrough</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">NixOS Release Wiki</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p align="center">
  <a href="https://nixos.org/nixos"><img src="https://nixos.org/logo/nixos-hires.png" width="500px" alt="NixOS logo" /></a>
</p>
<p>This is the official wiki for the NixOS release process.
All release managers should document how they're actively changing the release process here.
And also use as it as a reference on how to release NixOS and engage the community.</p>
<p>This is not a set of rules but rather what the previous release managers did.
It mainly serves as a list of tasks to remember and is not written in stone.
This means that if you are a Release Manager and think you can do thing better, feel free to do so!
Also, if you are not a Release Manager and think the process can be improved, open an Issue or Pull Request on the <a href="https://github.com/NixOS/release-wiki">repository</a>.</p>
<h1><a class="header" href="#release-management-team" id="release-management-team">Release Management Team</a></h1>
<blockquote>
<p>When you are nixpkgs committer, you already have the skillset necessary for release management.
You just need to apply it in a different way.</p>
<p>— Jon Ringer</p>
</blockquote>
<p>For each release there are two release managers. After each release the
release manager having managed two releases steps down and the release
management team of the last release appoints a new release manager.</p>
<p>This makes sure a release management team always consists of one release
manager who already has managed one release and one release manager
being introduced to their role, making it easier to pass on knowledge
and experience.</p>
<p>Release managers for the current NixOS release are tracked by GitHub
team
<a href="https://github.com/orgs/NixOS/teams/nixos-release-managers/members"><code>@NixOS/nixos-release-managers</code></a>.</p>
<p>A release manager’s role and responsibilities are:</p>
<ul>
<li>
<p>manage the release process</p>
</li>
<li>
<p>start discussions about features and changes for a given release</p>
</li>
<li>
<p>create a roadmap</p>
</li>
<li>
<p>release in cooperation with Eelco Dolstra</p>
</li>
<li>
<p>decide which bug fixes, features, etc… get backported after a
release</p>
</li>
</ul>
<p>This team has special write permissions to certain repositories in NixOS.
It is <strong>very</strong> important that the new co-release-manager removes the previous manager
from the team when they assign a new one.</p>
<p>A release manager must have the commit bit in the nixpkgs repository.</p>
<h1><a class="header" href="#release-critical-packages" id="release-critical-packages">Release Critical Packages</a></h1>
<p>These packages are deemed &quot;sufficiently complex&quot; in the package ecosystem to
warrant treating them differently when stabilizing the package set leading up to
a stable release. Generally, these packages will be closely related to <code>stdenv</code>
or fundamental to NixOS (e.g. <code>systemd</code>). The implications of 
<a href="https://github.com/NixOS/rfcs/blob/master/rfcs/0085-nixos-release-stablization.md">RFC 0085</a>
are that these packages can not have breaking changes applied to them for six weeks
leading up to a release date. This delay allows for changes in these packages to be
sufficiently stabilized through usage on unstable, and allows for many staging
iterations for these fixes to be applied.</p>
<h2><a class="header" href="#list-of-release-critical-packages" id="list-of-release-critical-packages">List of Release Critical Packages:</a></h2>
<ul>
<li><code>binutils</code></li>
<li><code>gcc</code></li>
<li><code>glibc</code></li>
<li><code>llvm</code></li>
<li><code>systemd</code></li>
</ul>
<h3><a class="header" href="#process-for-modifying-release-critical-packages" id="process-for-modifying-release-critical-packages">Process for Modifying Release Critical Packages</a></h3>
<p>A release retrospective will take place after a release occured; one of the
topics of discussion will be to modify the list of critical packages.
Packages may be added if they caused a significant amount of pain, or packages
may be removed if their updates cause little to no pain. Pain in this case
is defined as causing failing builds, regressions in downstream packages,
or regressions in user experience.</p>
<h1><a class="header" href="#release-process" id="release-process">Release Process</a></h1>
<p>These pages give an overview of the release process with as many details as there are available at the time of writing.</p>
<p>Since this is an ongoing refactoring, the last few steps are collapsed into a single page</p>
<h2><a class="header" href="#release-schedule" id="release-schedule">Release Schedule</a></h2>
<p>With <a href="https://github.com/NixOS/rfcs/blob/master/rfcs/0085-nixos-release-stablization.md">RFC85</a>, the release schedule is largely already dictated below:</p>
<table><thead><tr><th>Weeks from Release</th><th>Branches Affected</th><th>Events</th></tr></thead><tbody>
<tr><td>-8 Weeks</td><td></td><td>Ask ecosystems for desired changes, in &quot;Feature Freeze&quot;</td></tr>
<tr><td>-6 Weeks</td><td><code>staging-next</code>, <code>staging</code></td><td>Restrict breaking changes to Release Critical Packages</td></tr>
<tr><td>-4 Weeks</td><td><code>staging-next</code>, <code>staging</code></td><td>Restrict all breaking changes: allow only non-breaking updates and Desktop Manager changes</td></tr>
<tr><td>-3 Weeks</td><td><code>master</code></td><td>(Day before ZHF) merge <code>staging-next</code> into <code>master</code>, prep for ZHF</td></tr>
<tr><td>-3 Weeks</td><td><code>master</code></td><td>Begin ZHF, Focus on minimizing regressions in PRs targeting <code>master</code></td></tr>
<tr><td>-2 Weeks</td><td><code>master</code></td><td>Merge first <code>staging-next</code> fixes into <code>master</code>; begin second <code>staging-next</code> cycle</td></tr>
<tr><td>-2 Weeks</td><td><code>staging</code></td><td>Unrestrict all breaking changes; new changes will not be present in <code>master</code> before branch-off</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code></td><td>Merge second <code>staging-next</code> fix cycle</td></tr>
<tr><td>-1 Weeks</td><td><code>staging-next</code></td><td>Unrestrict all breaking changes; new changes will not be present in <code>master</code> before branch-off</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code>, <code>release</code></td><td>Perform Branch-off, create release channels, create new beta / unstable tags</td></tr>
<tr><td>-1 Weeks</td><td><code>master</code>, <code>release</code></td><td>ZHF transitions to &quot;backporting&quot; workflow</td></tr>
<tr><td>-1 Weeks</td><td><code>release</code></td><td>Prepare for release, finish remaining issues</td></tr>
<tr><td>0 Weeks</td><td><code>release</code></td><td><strong>Release!</strong></td></tr>
<tr><td>0 Weeks</td><td></td><td>ZHF Ends</td></tr>
<tr><td>+4 Weeks</td><td></td><td>Release Retrospective and final cleanup</td></tr>
</tbody></table>
<p>Clarification of terms:</p>
<table><thead><tr><th>Term</th><th>Definition</th></tr></thead><tbody>
<tr><td><code>staging</code></td><td>Git branch used to batch changes which cause large rebuilds (<code>500+</code> packages). This is to avoid straining infrastructure trying to build large package sets with each change. Since nix captures all changes in a dependency tree, a change to a fundamental package like glibc can affect <code>50,000+</code> packages.</td></tr>
<tr><td><code>staging-next</code></td><td>Git branch used to build all of the batched changes. This branch has a <a href="https://hydra.nixos.org/jobset/nixpkgs/staging-next">Hydra jobset</a> which is used to fix regressions before the changes will be merged into master.</td></tr>
<tr><td><code>ZHF</code></td><td>Zero Hydra Failures. A 2-4 week window before a release where there is a large attempt to stabilize failing builds. Also allows for additional &quot;housekeeping&quot; such as removing stale, abandoned, or unmaintained packages.</td></tr>
</tbody></table>
<p>The purpose of these changes are mainly to push &quot;riskier&quot; PRs to being merged earlier,
or after a release. Merging pull-requests which may have many downstream breakages should
be avoided right before ZHF, as ZHF should focus on stabilization of the nixpkgs package
set, and not distracted by large noise-to-signal build failures. Also, fixes to packages
which required the <code>staging</code> process will likely require additional <code>staging</code> cycles to
remedy the regressions.</p>
<h1><a class="header" href="#what-to-do-once-appointed" id="what-to-do-once-appointed">What to do once appointed</a></h1>
<p>You have been appointed as the new Release Manager? Congratulations!
This is a loose list of things you could start doing now.
These tasks are not urgent but can be done as early as the appointment which should start to get you into your new role.
While not urgent, these task need to be completed at some point before the release process starts.
The release manager of the previous release will get in contact with you and help you along the way.</p>
<p>This is not an actual part of the release process but rather preparations for starting the process.</p>
<ul>
<li>Get in contact with the previous release manager and schedule a meeting</li>
<li>Enter the <a href="https://matrix.to/#/#nixos-release-management:nixos.org">release management Matrix room</a></li>
<li>Gain access to the <a href="https://github.com/orgs/NixOS/teams/nixos-release-managers/members">release-manager GitHub Team</a> by asking any of the existing people with &quot;Manager&quot; rights
<ul>
<li>Also make sure there are only people left as members who are managing this release</li>
</ul>
</li>
<li>Ensure you have a <a href="https://hydra.nixos.org/">Hydra</a> account which will come in handy
<ul>
<li>Ensure that all release managers have at least <code>restart-jobs</code>, <code>bump-to-front</code>, and <code>cancel-build</code> privileges (see the top-right &quot;Preferences&quot; button). If they are missing, reach out to the Infrastructure team</li>
</ul>
</li>
<li>Create a blockers <a href="https://github.com/orgs/NixOS/projects">project</a> in the organization for your release and the next one
<ul>
<li>Also close old ones while you're at it and consider migrating remaining open issues to the current project</li>
</ul>
</li>
<li>You may also create a <a href="https://github.com/NixOS/nixpkgs/milestones">release milestone</a> in the nixpkgs project. This is not really used for the process but people from different subsystems often use it. If you don't create it, someone else will probably do so
<ul>
<li>Close milestones of previous releases</li>
</ul>
</li>
<li>Figure out a codename for the next release (not the one you are releasing but the next one) and write it down somewhere for the branch-off</li>
<li>Find someone to create a <a href="https://github.com/NixOS/nixos-artwork/tree/master/releases">logo</a> or create one yourself for the current release and PR it into the repository</li>
<li>Check if the process can be improved this release
<ul>
<li>Find comments on the Discourse posts, GitHub issues, … of the previous release and see if the comments suggest doing something different this time</li>
<li>Read the Discourse post of the last retrospective</li>
<li>Check the Issues and Pull Requests of the <a href="https://github.com/NixOS/release-wiki">release-wiki repository</a></li>
</ul>
</li>
<li>Figure out concrete dates for the week offsets outlined in schedule</li>
<li>Publish a &quot;Let's have a great XX.XX release cycle!&quot; post on Discourse, outlining the plans for this release. <a href="https://discourse.nixos.org/t/lets-have-a-great-22-05-release-cycle/18357">Example of 22.05</a>
<ul>
<li>This links to the release schedule issue (<a href="https://github.com/NixOS/nixpkgs/issues/165792">22.05 example</a>) which must be created before posting to Discourse</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#feature-freeze-announcement-and-pre-release-cleanup" id="feature-freeze-announcement-and-pre-release-cleanup">Feature Freeze announcement and pre-release cleanup</a></h1>
<p>The feature freeze announcement should be done 8 weeks before the release to
inform subsystem maintainers about the upcoming feature freeze and to discuss
potential blockers in the respective subsystems. This announcement is done on
GitHub (<a href="https://github.com/NixOS/nixpkgs/issues/167025">22.05
example</a>). It's also a good
idea to cross-post this to Discourse to raise awareness about the upcoming
freeze (<a href="https://discourse.nixos.org/t/22-05-feature-freeze/18453">22.05
example</a>).</p>
<p>People and teams will be pinged in this issue. The list of people and teams
pinged is generated from the teams list in nixpkgs. The script to generate
the pings is: <code>./maintainers/feature-freeze-teams.pl</code> in nixpkgs. The script
needs a GitHub username and a token to read the teams from the NixOS org.
Instructions are provided as a comment in the script.</p>
<p>You might need to add a comment that pings people again because GitHub seems
to limit the amount of people that can be pinged per post.</p>
<h2><a class="header" href="#pre-release-cleanup" id="pre-release-cleanup">Pre-release cleanup</a></h2>
<p>The pre-release cleanup consists of multiple small cleanups to keep the release
secure throughout its lifecycle while also maintaining some level of
cleanliness.</p>
<ul>
<li>
<p>Remove attributes that we know we will not be able to support,
especially if there is a stable alternative. E.g. Check that our
Linux kernels’ <a href="https://www.kernel.org/category/releases.html">projected
end-of-life</a> are
after our release projected end-of-life. Also check these package sets:</p>
<ul>
<li>MariaDB</li>
<li>PHP</li>
<li>PostgreSQL</li>
</ul>
</li>
<li>
<p>Attributes that can also be safely removed are packages that were broken for
more than 2 years.</p>
</li>
<li>
<p>Remove old aliases that have been <code>throw</code>s for at least one release. There is
a script in the nixpkgs tree to do that:
<code>maintainers/scripts/remove-old-aliases.py --file ./pkgs/top-level/aliases.nix --year 2019 --month 6</code>
The conversion to <code>throw</code>s is usually done in one big Pull Request so you can
remove all aliases from the date prior to this Pull Request. <a href="https://github.com/NixOS/nixpkgs/pull/161146">Example of the
2022 throw conversion</a>.</p>
</li>
</ul>
<h1><a class="header" href="#zero-hydra-failures" id="zero-hydra-failures">ZERO Hydra Failures</a></h1>
<h2><a class="header" href="#hydra-resource-scale-up" id="hydra-resource-scale-up">Hydra resource scale-up</a></h2>
<p>Some days before ZHF starts is a good time to request the scale up of Hydra
resources for the duration of ZHF and release to improve the iteration speed we
can support and reduce the timeframe of alowing large rebuilds.
<a href="https://github.com/NixOS/nixos-org-configurations/issues/186">21.11 example</a>.</p>
<h2><a class="header" href="#zhf-issue" id="zhf-issue">ZHF issue</a></h2>
<ul>
<li>
<p>Create an issue for tracking Zero Hydra Failures progress. ZHF is an effort
to get build failures down to zero.
<a href="https://github.com/NixOS/nixpkgs/issues/172160">22.05 example</a></p>
</li>
<li>
<p>With RFC85, the
<a href="https://hydra.nixos.org/jobset/nixpkgs/trunk">nixpkgs/trunk</a> jobset will be
used to track regressions.</p>
</li>
<li>
<p>Monitor the issue and linked Pull Requests and check if new blockers come up.</p>
</li>
<li>
<p>Get in contact with the staging team (for example via their Matrix room) in
the last days before branch-off to coordinate the staging-next merges.</p>
</li>
</ul>
<h1><a class="header" href="#branch-off" id="branch-off">Branch-off</a></h1>
<p>For these steps &quot;21.05&quot; represents the current release tag and &quot;21.11&quot; represents the next
(6 months in the future) release tag. &quot;20.11&quot; is the last release which was released 6 months
ago.</p>
<h2><a class="header" href="#jobset-creation" id="jobset-creation">Jobset creation</a></h2>
<p>The <a href="https://matrix.to/#/#infra:nixos.org">infrastructure team</a> can create the necessary jobsets
in advance. They will not evaluate because the release branch doesn't exist but it allows the
infrastructure team and the release team to work more asynchronously. Reach out to them 1-2 days
before release to create the necessary Hydra Jobsets. You can link them this section.</p>
<ul>
<li><a href="https://hydra.nixos.org/project/nixos">https://hydra.nixos.org/project/nixos</a>
<ul>
<li>release-21.05	NixOS 21.05</li>
<li>release-21.05-aarch64	NixOS 21.05</li>
<li>release-21.05-small	NixOS 21.05</li>
</ul>
</li>
<li><a href="https://hydra.nixos.org/project/nixpkgs">https://hydra.nixos.org/project/nixpkgs</a>
<ul>
<li>nixpkgs-21.05-darwin</li>
<li>staging-next-21.05</li>
</ul>
</li>
</ul>
<p>For example: <a href="https://hydra.nixos.org/jobset/nixos/release-21.05#tabs-configuration">21.05 configuration</a></p>
<table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>
<tr><td>State</td><td>Enabled</td></tr>
<tr><td>Description</td><td>NixOS 21.05 release branch</td></tr>
<tr><td>Nix expression</td><td><code>nixos/release-combined.nix</code> in input <code>nixpkgs</code></td></tr>
<tr><td>Check interval</td><td>5000000</td></tr>
<tr><td>Scheduling shares</td><td>500</td></tr>
<tr><td>Number of evaluations to keep</td><td>1</td></tr>
</tbody></table>
<p>Inputs:</p>
<table><thead><tr><th>Input name</th><th>Type</th><th>Values</th></tr></thead><tbody>
<tr><td><code>nixpkgs</code></td><td>Git checkout</td><td><code>https://github.com/NixOS/nixpkgs.git release-21.05</code></td></tr>
<tr><td><code>stableBranch</code></td><td>Boolean</td><td><code>false</code></td></tr>
<tr><td><code>supportedSystems</code></td><td>Nix expression</td><td><code>[ &quot;x86_64-linux&quot; &quot;aarch64-linux&quot; ]</code></td></tr>
</tbody></table>
<h2><a class="header" href="#actual-branch-off" id="actual-branch-off">Actual branch-off</a></h2>
<ol>
<li>
<p>Wait for the staging team to merge the final staging-next iteration</p>
<pre><code class="language-shell">git fetch upstream staging-next
git merge upstream/staging-next
</code></pre>
</li>
<li>
<p>Fetch and check out the master branch</p>
</li>
<li>
<p>Update the <a href="https://github.com/NixOS/nixpkgs/blob/master/.github/workflows/periodic-merge-24h.yml">periodic-merge workflow</a> to include the new branch, then commit and push to master</p>
</li>
<li>
<p>Create the release branch:</p>
<pre><code class="language-shell">git switch -c release-21.05
</code></pre>
</li>
<li>
<p><a href="https://github.com/NixOS/nixpkgs/commit/10e61bf5be57736035ec7a804cb0bf3d083bf2cf#diff-b3379a98640b35a5fe4b046150cd2df1639995edf231d18bbad832be6a70b45f">Bump the <code>system.defaultChannel</code> attribute in
<code>nixos/modules/misc/version.nix</code></a></p>
</li>
<li>
<p><a href="https://github.com/NixOS/nixpkgs/commit/10e61bf5be57736035ec7a804cb0bf3d083bf2cf#diff-20da30ee012d7d87842fb7953237870493c5497c995cba1e6f6c3aa9268398ff">Update <code>versionSuffix</code> in
<code>nixos/release.nix</code></a></p>
<p>To get the commit count, use the following command:</p>
<pre><code class="language-shell">git rev-list --count release-21.05
</code></pre>
</li>
<li>
<p>Commit the changes from the previous steps</p>
</li>
<li>
<p>Create the staging branches</p>
<pre><code class="language-shell">git branch staging-21.05
git branch staging-next-21.05
</code></pre>
</li>
<li>
<p>Tag the release and push everything</p>
<pre><code class="language-shell">git tag --annotate --message=&quot;Release 21.05-beta&quot; 21.05-beta
git push upstream master release-21.05 21.05-beta staging-21.05 staging-next-21.05
</code></pre>
</li>
<li>
<p>Switch back to the master branch and <a href="https://github.com/NixOS/nixpkgs/commit/01268fda85b7eee4e462c873d8654f975067731f#diff-2bc0e46110b507d6d5a344264ef15adaR1">increment the <code>.version</code>
file</a></p>
<pre><code class="language-sh">git switch master
echo -n &quot;21.11&quot; &gt; .version
</code></pre>
</li>
<li>
<p><a href="https://github.com/NixOS/nixpkgs/commit/01268fda85b7eee4e462c873d8654f975067731f#diff-03f3d41b68f62079c55001f1a1c55c1dR137">Update <code>codeName</code> in
<code>lib/trivial.nix</code></a>
This will be the name for the next release.</p>
</li>
<li>
<p><a href="https://github.com/NixOS/nixpkgs/commit/01268fda85b7eee4e462c873d8654f975067731f#diff-e7ee5ff686cdcc513ca089d6e5682587R11">Create a new release notes file for the upcoming release +
1</a>,
in our case this is <code>rl-2111.section.md</code>. Don't forget to link the new file in the parent markdown file and to run <code>md-to-db.sh</code></p>
</li>
<li>
<p>Commit the changes (<a href="https://github.com/NixOS/nixpkgs/commit/bfdfe12c788d7474b88e7a7790b88b1c0f8e01b5">22.05 example</a>)</p>
</li>
<li>
<p>Tag master branch so that <code>git describe</code> shows the correct metadata.</p>
<pre><code class="language-shell">git tag --annotate 21.11-pre
git push upstream master 21.11-pre
git describe HEAD # should yield 21.11-pre
</code></pre>
</li>
<li>
<p>Trigger an evaluation of the new jobsets in Hydra</p>
</li>
<li>
<p>Create a channel at <code>https://nixos.org/channels</code> by creating a PR to
<code>nixos-org-configurations</code>. Update <a href="https://github.com/NixOS/nixos-org-configurations/blob/master/channels.nix"><code>channels.nix</code></a> to include the channel as a beta channel and notify the infrastructure team. <a href="https://github.com/NixOS/nixos-org-configurations/pull/209">22.05 example</a></p>
</li>
<li>
<p>Create the backport <a href="https://github.com/NixOS/nixpkgs/labels">labels</a> for all new branches:</p>
<ul>
<li><code>backport staging-21.05</code></li>
<li><code>backport staging-21.05</code></li>
</ul>
<p>Use the description <code>Backport PR automatically</code> and the color value <code>#0fafaa</code></p>
</li>
<li>
<p>Update the flake input of nixos-search once the Pull Request in <code>nixos-org-configurations</code> is merged:</p>
<ul>
<li>Clone <a href="https://github.com/NixOS/nixos-search">nixos-search</a></li>
<li>Update the flake inputs:
<pre><code class="language-shell">nix --extra-experimental-features nix-command\ flakes flake update
</code></pre>
</li>
<li>Commit the result and create a Pull Request</li>
</ul>
</li>
<li>
<p>Inform the <a href="https://matrix.to/#/#marketing:nixos.org">Marketing team</a> about the upcoming release and the <code>nixos-serach</code> Pull Request</p>
</li>
</ol>
<h1><a class="header" href="#release-process-walkthrough" id="release-process-walkthrough">Release Process Walkthrough</a></h1>
<h2><a class="header" href="#during-beta" id="during-beta">During Beta</a></h2>
<ul>
<li>Monitor the master branch for bugfixes and minor updates and
cherry-pick them to the release branch.</li>
</ul>
<h2><a class="header" href="#before-the-final-release" id="before-the-final-release">Before the final release</a></h2>
<ul>
<li>
<p>Two days before expected release date, change <code>stableBranch</code> to <code>true</code> in Hydra and wait for the channel to update.</p>
</li>
<li>
<p>Re-check that the release notes are complete.</p>
</li>
<li>
<p>Release Nix (currently only Eelco Dolstra can do that). <a href="https://github.com/NixOS/nixpkgs/blob/master/nixos/modules/installer/tools/nix-fallback-paths.nix">Make sure fallback is updated.</a></p>
</li>
<li>
<p><a href="https://github.com/NixOS/nixpkgs/commit/40fd9ae3ac8048758abdcfc7d28a78b5f22fe97e">Update README.md with new stable NixOS version information.</a> (for both <code>master</code> then backport to <code>release-19.09</code> branch)</p>
</li>
<li>
<p>Ensure the following items are sufficiently tested:</p>
<ul>
<li>Graphical NixOS installer images (Can be found on nixos hydra jobset)</li>
<li>Minimal NixOS installer images (Can be found on nixos hydra jobset)</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#at-final-release-time" id="at-final-release-time">At final release time</a></h2>
<p>Create these PRs on master and backport to release-19.09.</p>
<ol>
<li>
<p>Update <a href="https://nixos.org/manual/nixos/stable/index.html#sec-upgrading">Upgrading NixOS</a> section of the manual to match new
stable release version.</p>
</li>
<li>
<p>Update <code>rl-1909.xml</code> with the release date.</p>
</li>
<li>
<p>Tag the final release</p>
</li>
</ol>
<pre><code class="language-sh">git tag --annotate --message=&quot;Release 19.09&quot; 19.09
git push upstream 19.09
</code></pre>
<ol start="4">
<li>
<p>Update <a href="https://github.com/NixOS/nixos-homepage">nixos-homepage</a> for
the release.</p>
<ol>
<li>
<p><a href="https://github.com/NixOS/nixos-homepage/blob/47ac3571c4d71e841fd4e6c6e1872e762b9c4942/flake.nix#L10">Update the <code>flake.nix</code> input <code>released-nixpkgs</code> to 19.09</a>.</p>
</li>
<li>
<p>Run <code>./scripts/update.sh</code> (this updates flake.lock to updated channel).</p>
</li>
<li>
<p><a href="https://github.com/NixOS/nixos-homepage/blob/a5626c71c03a2dd69086564e56f1a230a2bb177a/logo/nixos-logo-19.09-loris-lores.png">Add a compressed version of the NixOS logo for 19.09</a>.</p>
</li>
<li>
<p><a href="https://github.com/NixOS/nixos-homepage/commit/a5626c71c03a2dd69086564e56f1a230a2bb177a#diff-9cdc6434d3e4fd93a6e5bb0a531a7c71R5">Compose a news item for the website RSSfeed</a>.</p>
</li>
</ol>
</li>
<li>
<p>Update <a href="https://github.com/NixOS/nixos-search/">nixos-search</a></p>
<ol>
<li>
<p>Follow similar changes to <a href="https://github.com/NixOS/nixos-search/pull/311/files">this PR</a>.</p>
</li>
<li>
<p>Get in contact with Garbas to ensure proper deployment.</p>
</li>
</ol>
</li>
<li>
<p>Create a new topic on <a href="https://discourse.nixos.org/">the Discourse instance</a> to announce the release.</p>
</li>
</ol>
<p>You should include the following information:</p>
<ul>
<li>Number of commits for the release:</li>
</ul>
<pre><code class="language-sh">git log upstream/release-19.03..upstream/release-19.09 --format=%an | wc -l
</code></pre>
<ul>
<li>Commits by contributor:</li>
</ul>
<pre><code class="language-sh">git shortlog --summary --numbered release-19.03..release-19.09
</code></pre>
<p>Best to check how the previous post was formulated to see what needs to
be included.</p>
<ol start="7">
<li>Update <a href="https://github.com/NixOS/nixos-org-configurations/pull/192/files">nixos-org-configurations</a> with updated channel status</li>
</ol>
<ul>
<li>previous stable branches should be marked &quot;deprecated&quot;</li>
<li>beta branches should be marked &quot;stable&quot;</li>
</ul>
<h2><a class="header" href="#after-release" id="after-release">After Release</a></h2>
<ol>
<li>
<p><a href="https://github.com/repology/repology-updater/pull/1156/files">Update repology</a></p>
</li>
<li>
<p>Update osinfo-db entries. <a href="https://gitlab.com/libosinfo/osinfo-db/-/merge_requests/312">example</a></p>
</li>
</ol>
<pre><code class="language-sh">nix-shell -p &quot;python3.withPackages (p: [ p.lxml p.requests ])&quot; -p cdrkit
./scripts/updates/nixos.py --release YY.MM --codename &lt;codename&gt; --release-date YYYY-MM-DD --next-release YY.MM
git add .
git commit -s -m &quot;nixos: Add YY.MM release&quot;

# run tests to validate your changes
nix-shell -p &quot;python3.withPackages (p: [ p.lxml p.requests p.pytest ])&quot; -p cdrkit osinfo-db-tools gettext --run &quot;make check&quot;
</code></pre>
<ol start="3">
<li>
<p>Update ami images</p>
</li>
<li>
<p>Someone with s3 buck permssions will need to run <code>https://github.com/NixOS/nixpkgs/blob/master/nixos/maintainers/scripts/ec2/create-amis.sh</code> (usually AmineChikhaoui).</p>
</li>
<li>
<p><a href="https://github.com/NixOS/nixpkgs/pull/101720">Create PR adding it to NixOS configuration</a>.</p>
</li>
</ol>
<h2><a class="header" href="#a-month-after-release" id="a-month-after-release">A Month after Release</a></h2>
<ol>
<li><a href="https://github.com/NixOS/nixos-org-configurations/pull/201">EOL Channels should be marked unmaintained</a></li>
<li>Increase the <code>oldestSupportedRelease</code> in <code>lib/trivial.nix</code> to match the oldest non-EOL release.</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
